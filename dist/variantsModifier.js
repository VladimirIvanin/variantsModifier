/*!
 * VariantsModifier v0.4.1
 * https://github.com/VladimirIvanin/VariantsModifier
 * Vladimir Ivanin
 * 2017
 */
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function Modifier(e,r,n){var i=this;i.options=r,i.$form=e,i.productInstance=n.productInstance,i.productJSON=n.productJSON,i.initElements=initElements,i.bindingVariants=bindingVariants,i.renderPrice=renderPrice,i.renderOldPrice=renderOldPrice,i.renderAvailable=renderAvailable,i.renderSku=renderSku,i.renderQuantity=renderQuantity,i.renderImage=renderImage,i.getDataParam=getDataParam,i.isInitImage=!1,r.initVariantImage&&(i.isInitImage=!0),i.getDataParam(),i.initElements(),i.initElements(),i.bindingVariants()}var initElements=require("./initElements"),renderPrice=require("./render").renderPrice,renderOldPrice=require("./render").renderOldPrice,renderAvailable=require("./render").renderAvailable,renderSku=require("./render").renderSku,renderQuantity=require("./render").renderQuantity,renderImage=require("./render").renderImage,bindingVariants=require("./bindingVariants"),getDataParam=require("./getDataParam");Modifier.prototype.updateVariant=function(e){var r=e.action.product?e.action.product[0]:null,n=this;n.renderPrice(e),n.renderOldPrice(e),n.renderAvailable(e),n.renderSku(e),n.renderQuantity(e),n.renderImage(e),n.options.updateVariant(e,r)},module.exports=Modifier;
},{"./bindingVariants":2,"./getDataParam":3,"./initElements":6,"./render":7}],2:[function(require,module,exports){
function bindingVariants(){var i=this,t=i.options,a=t.thumbSize,n=t.thumbWrap,e=i.productJSON,r=i.productInstance;if(e.variants&&e.variants.length&&t.useTriggerThumb){var s={};$.each(e.variants,function(t,e){var c=e.first_image.filename,o=$(n+' [src*="'+a+"_"+c+'"]').eq(0).parents(n+":first");s[c]||(s[c]=!0,o.click(function(t){i.activeImage!=c&&(i.activeImage=c,t.isModifier||Products.getInstance(r).done(function(i){i.variants.setVariant(e.id)}))}))})}}module.exports=bindingVariants;
},{}],3:[function(require,module,exports){
function getDataParam(){var a=this,t=a.options,o=a.$form,r=t.dataParam;$.each(r,function(a,r){var e=o.data(r);e&&(t[a]=e)})}module.exports=getDataParam;
},{}],4:[function(require,module,exports){
var defaults=require("../variables").defaults,init=require("./init"),setVariantByImage=require("./setVariantByImage"),VariantsModifier=function(e){var i=this;return i.options=$.extend(!0,{},defaults,e),i.init=init,i.setVariantByImage=setVariantByImage,EventBus?i.init():console.warn("Не подключен common.js"),i};module.exports=VariantsModifier;
},{"../variables":10,"./init":5,"./setVariantByImage":8}],5:[function(require,module,exports){
function init(){var i=this;EventBus.subscribe("update_variant:insales:product",function(n){var t=n.action.product?n.action.product[0]:null;t&&!t.instanceVariantsModifier&&(t.instanceVariantsModifier=new Modifier($(t),i.options,n.action)),t&&t.instanceVariantsModifier&&(n.action.quantityState.change||t.instanceVariantsModifier.updateVariant(n))})}var Modifier=require("./Modifier");module.exports=init;
},{"./Modifier":1}],6:[function(require,module,exports){
function initElements(){var i=this,e=i.$form,n=i.options.selectors;i.$price=e.find(n.price),i.$oldPrice=e.find(n.oldPrice),i.$sku=e.find(n.sku),i.$quantity=e.find(n.quantity),i.$available=e.find(n.available)}module.exports=initElements;
},{}],7:[function(require,module,exports){
function renderQuantity(e){var t=this,a=t.$quantity,i=t.options,r=i.templates,l=i.classes,s=e.quantity,n=r.quantityAlot,o=l.quantityAlot;if(!i.checkQuantityVariant){var u=0;$.each(t.productJSON.variants,function(e,t){t.quantity&&(u+=t.quantity)}),s=u}s<=i.quantityEnds&&(n=r.quantityEnds,o=l.quantityEnds),i.checkQuantityVariant?e.available?null===s&&"object"==typeof s&&(n=r[i.quantityNull],o=l[i.quantityNull]):(n=r.quantityNotAvailable,o=l.quantityNotAvailable):t.productJSON.available?0===s&&(n=r[i.quantityNull],o=l[i.quantityNull]):(n=r.quantityNotAvailable,o=l.quantityNotAvailable);var m=getTemplate(n,"");a.removeClass(l.quantityEnds).removeClass(l.quantityAlot).removeClass(l.quantityNotAvailable),a.html(m).addClass(o)}function renderPrice(e){var t=this,a=t.$price,i=t.options.templates,r=Shop.money.format(e.price),l=getTemplate(i.price,r);a.html(l),t.options.updatePrice(e,t.$form)}function renderOldPrice(e){var t=this,a=t.$form,i=t.$oldPrice,r=(Shop.money.format(e.old_price||e.price),t.options),l=r.classes,s=r.templates,n=Shop.money.format(e.oldPrice),o=getTemplate(s.oldPrice,n),u=getTemplate(s.emptyOldPrice,n);e.old_price?(i.html(o),a.addClass(l.withOldPrice),a.removeClass(l.withoutOldPrice),r.useToggleOldPrice&&i.show()):(i.html(u),a.addClass(l.withoutOldPrice),a.removeClass(l.withOldPrice),r.useToggleOldPrice&&i.hide()),t.options.updateOldPrice(e,a)}function renderAvailable(e){var t=this,a=t.$form,i=t.$available,r=t.options,l=r.classes,s=r.templates,n=getTemplate(s.available,""),o=getTemplate(s.notAvailable,"");e.available?(i.html(n),a.addClass(l.isAvailable).removeClass(l.notAvailable)):(i.html(o),a.addClass(l.notAvailable).removeClass(l.isAvailable)),t.options.updateAvailable(e,a)}function renderSku(e){var t=this,a=t.$form,i=t.$sku,r=t.options,l=r.classes,s=r.templates,n=getTemplate(s.sku,e.sku),o=getTemplate(s.emptySku,e.sku);e.sku?(i.html(n),a.addClass(l.withSku).removeClass(l.withoutSku),r.useToggleSku&&i.show()):(i.html(o),a.addClass(l.withoutSku).removeClass(l.withSku),r.useToggleSku&&i.hide()),t.options.updateSku(e,a)}function renderImage(e){var t=this,a=t.options,i=e.first_image,r=e.first_image.filename,l=$('[href*="'+r+'"]'),s={$all:$('[src*="'+r+'"]'),$compacts:$('[src*="compact_'+r+'"]'),$larges:$('[src*="large_'+r+'"]'),$mediums:$('[src*="medium_'+r+'"]'),$micros:$('[src*="micro_'+r+'"]'),$thumb:$('[src*="thumb_'+r+'"]'),$originals:$('[src$="'+r+'"]')};if(a.useTriggerThumb&&t.isInitImage){var n=a.thumbSize,o=a.thumbWrap,u=jQuery.Event("click");u.isModifier=!0,$(o+' [src*="'+n+"_"+r+'"]').eq(0).parents(o+":first").trigger(u)}t.isInitImage=!0,t.options.updateImage(e,t.$form,s,i,l)}function getTemplate(e,t){return e&&"string"==typeof e||(e=""),t&&"string"==typeof t||(t=""),e.replace(/%s%/g,t)}var setVariantByImage=require("./setVariantByImage");module.exports={renderQuantity:renderQuantity,renderPrice:renderPrice,renderOldPrice:renderOldPrice,renderAvailable:renderAvailable,renderSku:renderSku,renderImage:renderImage};
},{"./setVariantByImage":8}],8:[function(require,module,exports){
function setVariantByImage(e){var a=e.$form,i=getFileName(e.src,e.size),t=a.get(0);if(t){var n=t.instanceVariantsModifier;if(n){var r=n.productJSON,c=!1;$.each(r.variants,function(e,a){var t=a.first_image.filename;i!==t||c||(c=a.id)}),n.inProcess||c&&i!==n.activeImage&&(n.inProcess=!0,Products.getInstance(n.productInstance).done(function(e){n.inProcess=!1,n.activeImage=i,e.variants.setVariant(c)}))}}}function getFileName(e,a){"string"!=typeof e&&(e="",console.warn("Передан пустой url для изображения"));var i=e.split("/"),t=i[i.length-1],n=["compact_","large_","medium_","micro_","thumb_"];return!a||a&&""==a?$.each(n,function(e,a){0!==t.indexOf(a)||(t=t.replace(a,""))}):"original"!=a&&(t=t.replace(a+"_","")),t}module.exports=setVariantByImage;
},{}],9:[function(require,module,exports){
window.VariantsModifier=require("VariantsModifier");
},{"VariantsModifier":4}],10:[function(require,module,exports){
var defaults={selectors:{oldPrice:"[data-product-old-price]",price:"[data-product-price]",sku:"[data-product-sku]",quantity:"[data-quantity-message]",available:"[data-product-available]"},templates:{price:"%s%",oldPrice:"%s%",emptyOldPrice:"",sku:"арт. %s%",emptySku:"",available:"Есть в наличии",notAvailable:"Нет в наличии",quantityEnds:"Заканчивается",quantityAlot:"Много",quantityNotAvailable:"Нет в наличии"},classes:{withOldPrice:"with-old-price",withoutOldPrice:"without-old-price",withSku:"with-sku",withoutSku:"without-sku",isAvailable:"is-available",notAvailable:"not-available",quantityEnds:"is-quantity-ends",quantityAlot:"is-quantity-alot",quantityNotAvailable:"is-quantity-not-available"},quantityEnds:10,thumbSize:"compact",thumbWrap:".js-image-variant",initVariantImage:!1,useTriggerThumb:!0,useToggleOldPrice:!0,useToggleSku:!0,checkQuantityVariant:!0,quantityNull:"quantityAlot",dataParam:{quantityNull:"quantity-null",quantityEnds:"quantity-ends",checkQuantytiVariant:"check-quantity-variant"},updatePrice:function(){},updateOldPrice:function(){},updateAvailable:function(){},updateSku:function(){},updateImage:function(){},updateVariant:function(){}},system={};module.exports={defaults:defaults,system:system};
},{}]},{},[9]);
