/*!
 * VariantsModifier v0.3.0
 * https://github.com/VladimirIvanin/VariantsModifier
 * Vladimir Ivanin
 * 2017
 */
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function Modifier(e,r,n){var i=this;i.options=r,i.$form=e,i.productInstance=n.productInstance,i.productJSON=n.productJSON,i.initElements=initElements,i.bindingVariants=bindingVariants,i.renderPrice=renderPrice,i.renderOldPrice=renderOldPrice,i.renderAvailable=renderAvailable,i.renderSku=renderSku,i.renderImage=renderImage,i.isInitImage=!1,r.initVariantImage&&(i.isInitImage=!0),i.initElements(),i.bindingVariants()}var initElements=require("./initElements"),renderPrice=require("./render").renderPrice,renderOldPrice=require("./render").renderOldPrice,renderAvailable=require("./render").renderAvailable,renderSku=require("./render").renderSku,renderImage=require("./render").renderImage,bindingVariants=require("./bindingVariants");Modifier.prototype.updateVariant=function(e){var r=e.action.product?e.action.product[0]:null,n=this;n.options.updateVariant(e,r),n.renderPrice(e),n.renderOldPrice(e),n.renderAvailable(e),n.renderSku(e),n.renderImage(e)},module.exports=Modifier;
},{"./bindingVariants":2,"./initElements":5,"./render":6}],2:[function(require,module,exports){
function bindingVariants(){var i=this,n=i.options,t=n.thumbSize,a=n.thumbWrap,r=i.productJSON,e=i.productInstance;if(r.variants&&r.variants.length&&n.useTriggerThumb){var s={};$.each(r.variants,function(n,r){var c=r.first_image.filename,o=$(a+' [src*="'+t+"_"+c+'"]').eq(0).parents(a+":first");s[c]||(s[c]=!0,o.click(function(n){i.activeImage=c,n.isModifier||Products.getInstance(e).done(function(i){i.variants.setVariant(r.id)})}))})}}module.exports=bindingVariants;
},{}],3:[function(require,module,exports){
var defaults=require("../variables").defaults,init=require("./init"),setVariantByImage=require("./setVariantByImage"),VariantsModifier=function(e){var i=this;return i.options=$.extend(!0,{},defaults,e),i.init=init,i.setVariantByImage=setVariantByImage,EventBus?i.init():console.warn("Не подключен common.js"),i};module.exports=VariantsModifier;
},{"../variables":9,"./init":4,"./setVariantByImage":7}],4:[function(require,module,exports){
function init(){var i=this;EventBus.subscribe("update_variant:insales:product",function(n){var t=n.action.product?n.action.product[0]:null;t&&!t.instanceVariantsModifier&&(t.instanceVariantsModifier=new Modifier($(t),i.options,n.action)),t&&t.instanceVariantsModifier&&t.instanceVariantsModifier.updateVariant(n)})}var Modifier=require("./Modifier");module.exports=init;
},{"./Modifier":1}],5:[function(require,module,exports){
function initElements(){var i=this,e=i.$form,n=i.options.selectors;i.$price=e.find(n.price),i.$oldPrice=e.find(n.oldPrice),i.$sku=e.find(n.sku),i.$available=e.find(n.available)}module.exports=initElements;
},{}],6:[function(require,module,exports){
function renderPrice(e){var r=this,t=r.$price,a=r.options.templates,i=Shop.money.format(e.price),s=getTemplate(a.price,i);t.html(s),r.options.updatePrice(e,r.$form)}function renderOldPrice(e){var r=this,t=r.$form,a=r.$oldPrice,i=(Shop.money.format(e.old_price||e.price),r.options),s=i.classes,l=i.templates,o=Shop.money.format(e.oldPrice),m=getTemplate(l.oldPrice,o),d=getTemplate(l.emptyOldPrice,o);e.old_price?(a.html(m),t.addClass(s.withOldPrice),t.removeClass(s.withoutOldPrice),i.useToggleOldPrice&&a.show()):(a.html(d),t.addClass(s.withoutOldPrice),t.removeClass(s.withOldPrice),i.useToggleOldPrice&&a.hide()),r.options.updateOldPrice(e,t)}function renderAvailable(e){var r=this,t=r.$form,a=r.$available,i=r.options,s=i.classes,l=i.templates,o=getTemplate(l.available,""),m=getTemplate(l.notAvailable,"");e.available?(a.html(o),t.addClass(s.isAvailable).removeClass(s.notAvailable)):(a.html(m),t.addClass(s.notAvailable).removeClass(s.isAvailable)),r.options.updateAvailable(e,t)}function renderSku(e){var r=this,t=r.$form,a=r.$sku,i=r.options,s=i.classes,l=i.templates,o=getTemplate(l.sku,e.sku),m=getTemplate(l.emptySku,e.sku);e.sku?(a.html(o),t.addClass(s.withSku).removeClass(s.withoutSku),i.useToggleSku&&a.show()):(a.html(m),t.addClass(s.withoutSku).removeClass(s.withSku),i.useToggleSku&&a.hide()),r.options.updateSku(e,t)}function renderImage(e){var r=this,t=r.options,a=e.first_image,i=e.first_image.filename,s=$('[href*="'+i+'"]'),l={$all:$('[src*="'+i+'"]'),$compacts:$('[src*="compact_'+i+'"]'),$larges:$('[src*="large_'+i+'"]'),$mediums:$('[src*="medium_'+i+'"]'),$micros:$('[src*="micro_'+i+'"]'),$thumb:$('[src*="thumb_'+i+'"]'),$originals:$('[src$="'+i+'"]')};if(t.useTriggerThumb&&r.isInitImage){var o=t.thumbSize,m=t.thumbWrap,d=jQuery.Event("click");d.isModifier=!0,$(m+' [src*="'+o+"_"+i+'"]').eq(0).parents(m+":first").trigger(d)}r.isInitImage=!0,r.options.updateImage(e,r.$form,l,a,s)}function getTemplate(e,r){return e&&"string"==typeof e||(e=""),r&&"string"==typeof r||(r=""),e.replace(/%s%/g,r)}var setVariantByImage=require("./setVariantByImage");module.exports={renderPrice:renderPrice,renderOldPrice:renderOldPrice,renderAvailable:renderAvailable,renderSku:renderSku,renderImage:renderImage};
},{"./setVariantByImage":7}],7:[function(require,module,exports){
function setVariantByImage(e){var a=e.$form,t=getFileName(e.src),n=a.get(0);if(n){var i=n.instanceVariantsModifier;if(i){var r=i.productJSON,c=!1;$.each(r.variants,function(e,a){var n=a.first_image.filename;t!==n||c||(c=a.id)}),c&&t!==i.activeImage&&Products.getInstance(i.productInstance).done(function(e){i.activeImage=t,e.variants.setVariant(c)})}}}function getFileName(e){"string"!=typeof e&&(e="",console.warn("Передан пустой url для изображения"));var a=e.split("/"),t=a[a.length-1],n=["compact_","large_","medium_","micro_","thumb_"];return $.each(n,function(e,a){0!==t.indexOf(a)||(t=t.replace(a,""))}),t}module.exports=setVariantByImage;
},{}],8:[function(require,module,exports){
window.VariantsModifier=require("VariantsModifier");
},{"VariantsModifier":3}],9:[function(require,module,exports){
var defaults={selectors:{oldPrice:"[data-product-old-price]",price:"[data-product-price]",sku:"[data-product-sku]",available:"[data-product-available]"},templates:{price:"%s%",oldPrice:"%s%",emptyOldPrice:"",sku:"арт. %s%",emptySku:"",available:"Есть в наличии",notAvailable:"Нет в наличии"},classes:{withOldPrice:"with-old-price",withoutOldPrice:"without-old-price",withSku:"with-sku",withoutSku:"without-sku",isAvailable:"is-available",notAvailable:"not-available"},thumbSize:"compact",thumbWrap:".js-image-variant",initVariantImage:!1,useTriggerThumb:!0,useToggleOldPrice:!0,useToggleSku:!0,updatePrice:function(){},updateOldPrice:function(){},updateAvailable:function(){},updateSku:function(){},updateImage:function(){},updateVariant:function(){}},system={};module.exports={defaults:defaults,system:system};
},{}]},{},[8]);
